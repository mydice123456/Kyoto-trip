<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>京都跨年之旅 Kyoto Trip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        kyoto: {
                            bg: '#f4f4f0',      /* 米白背景 */
                            dark: '#2c3e50',    /* 深藍文字 */
                            green: '#7c9473',   /* 抹茶綠 (強調色) */
                            accent: '#cf5d3e',  /* 朱紅色 (強調/警告) */
                            light: '#e8e8e4',   /* 淺灰分隔線 */
                            card: '#ffffff'     /* 卡片白底 */
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <style>
        /* App 優化樣式 */
        body {
            background-color: #f4f4f0; /* 延伸頁首圖片底色 */
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* 隱藏滾動條但保持功能 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* 頁首圓弧處理 */
        .header-curve {
            border-top-left-radius: 30px;
            border-top-right-radius: 30px;
            margin-top: -30px; /* 負邊距創造重疊效果 */
            position: relative;
            z-index: 10;
            background-color: #f4f4f0;
            box-shadow: 0 -4px 6px -1px rgba(0, 0, 0, 0.05);
        }
        /* 浮動導航按鈕樣式 */
        .float-nav-btn {
            @apply flex flex-col items-center justify-center w-14 h-14 rounded-full bg-white shadow-md text-kyoto-dark transition-all duration-300;
        }
        .float-nav-btn.active {
            @apply bg-kyoto-green text-white shadow-lg transform -translate-y-1;
        }
        /* 新增按鈕樣式 */
        .add-btn-float {
            @apply fixed bottom-6 right-6 w-14 h-14 bg-kyoto-green text-white rounded-full shadow-lg flex items-center justify-center text-2xl z-50 hover:bg-opacity-90 transition-all;
        }
    </style>
</head>
<body class="text-kyoto-dark overflow-x-hidden">

<div id="app" class="min-h-screen pb-20">

    <header class="relative">
        <div class="h-[250px] w-full bg-cover bg-center" style="background-image: url('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?q=80&w=1920&auto=format&fit=crop');">
            </div>

        <div class="absolute right-4 -bottom-7 z-20 flex space-x-3">
            <button @click="currentTab = 'itinerary'" :class="['float-nav-btn', currentTab === 'itinerary' ? 'active' : '']">
                <i class="fa-solid fa-map-location-dot text-lg"></i>
                <span class="text-[10px] mt-1">行程</span>
            </button>
            <button @click="currentTab = 'info'" :class="['float-nav-btn', currentTab === 'info' ? 'active' : '']">
                <i class="fa-solid fa-circle-info text-lg"></i>
                <span class="text-[10px] mt-1">資訊</span>
            </button>
            <button @click="currentTab = 'shopping'" :class="['float-nav-btn', currentTab === 'shopping' ? 'active' : '']">
                <i class="fa-solid fa-basket-shopping text-lg"></i>
                <span class="text-[10px] mt-1">購物</span>
            </button>
            <button @click="currentTab = 'expenses'" :class="['float-nav-btn', currentTab === 'expenses' ? 'active' : '']">
                <i class="fa-solid fa-coins text-lg"></i>
                <span class="text-[10px] mt-1">花費</span>
            </button>
        </div>
    </header>

    <main class="header-curve pt-10 px-4">

        <div v-if="currentTab === 'itinerary'">
            
            <div class="bg-kyoto-card rounded-xl p-4 shadow-sm mb-4 flex items-center justify-between">
                <div class="flex items-center">
                    <i class="fa-solid fa-cloud-sun text-3xl text-kyoto-green mr-3"></i>
                    <div>
                        <div class="text-lg font-bold">京都</div>
                        <div class="text-sm text-gray-500">多雲時晴</div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-2xl font-bold">8°C</div>
                    <div class="text-xs text-gray-500">體感 5°C</div>
                </div>
            </div>

            <div class="flex space-x-4 overflow-x-auto no-scrollbar mb-6 py-2">
                <button v-for="(day, index) in itineraryData" :key="index" 
                        @click="selectedDayIndex = index"
                        :class="['flex-shrink-0 flex flex-col items-center justify-center w-16 h-20 rounded-xl transition-all', 
                                 selectedDayIndex === index ? 'bg-kyoto-green text-white shadow-md' : 'bg-kyoto-card text-kyoto-dark shadow-sm']">
                    <span class="text-sm font-medium">{{ getDayName(day.date) }}</span>
                    <span class="text-2xl font-bold">{{ getDayNumber(day.date) }}</span>
                </button>
            </div>

            <div class="space-y-4">
                <div v-for="(item, index) in currentDayItinerary.items" :key="item.id" class="relative">
                    
                    <div v-if="index > 0" class="flex items-center justify-center py-2 text-xs text-gray-500">
                        <i :class="getTransportIcon(item.transportType)" class="mr-2"></i>
                        <span>{{ item.travelTimeText || '計算中...' }}</span>
                         <div class="absolute top-0 bottom-0 left-8 w-0.5 bg-kyoto-light -z-10" style="top: -10px; bottom: 50%;"></div>
                    </div>
                    <div v-if="index === 0 && item.type !== 'flight'" class="flex items-center justify-center py-2 text-xs text-gray-500">
                        <i class="fa-solid fa-hotel mr-2"></i>
                        <span>從飯店出發</span>
                    </div>

                    <div :class="['bg-kyoto-card rounded-xl shadow-sm p-4 flex flex-col relative overflow-hidden', item.type === 'flight' ? 'border-l-4 border-kyoto-accent' : 'border-l-4 border-kyoto-green']">
                         <span class="absolute top-0 right-0 px-2 py-1 text-[10px] text-white rounded-bl-lg" 
                              :class="item.type === 'flight' ? 'bg-kyoto-accent' : 'bg-kyoto-green'">
                            {{ getCategoryName(item.type) }}
                        </span>

                        <div class="flex-1 cursor-pointer" @click="openGoogleMaps(item.name)">
                            <div class="flex items-start mb-2">
                                <div class="mr-4 text-center min-w-[50px]">
                                    <div class="text-lg font-bold leading-tight">{{ formatTime(item.time) }}</div>
                                    <i class="fa-solid fa-location-dot text-kyoto-green mt-2"></i>
                                </div>
                                <div class="flex-1">
                                    <h3 class="text-lg font-bold mb-1">{{ item.name }}</h3>
                                    <div class="text-sm text-gray-600 mb-2 space-y-1">
                                        <p v-if="item.businessHours"><i class="fa-regular fa-clock mr-1 w-4"></i> {{ item.businessHours }}</p>
                                        <p v-if="item.ticketInfo"><i class="fa-solid fa-ticket mr-1 w-4"></i> {{ item.ticketInfo }}</p>
                                    </div>
                                </div>
                            </div>
                            <div v-if="item.notes" class="bg-kyoto-bg p-2 rounded-lg text-sm text-gray-700">
                                <span class="font-medium text-kyoto-green">Note:</span> {{ item.notes }}
                            </div>
                        </div>

                        <div class="flex justify-end mt-2 pt-2 border-t border-kyoto-light text-gray-400">
                            <button @click.stop="moveItem(index, -1)" :disabled="index === 0" class="px-2 hover:text-kyoto-green disabled:opacity-30"><i class="fa-solid fa-arrow-up"></i></button>
                            <button @click.stop="moveItem(index, 1)" :disabled="index === currentDayItinerary.items.length - 1" class="px-2 hover:text-kyoto-green disabled:opacity-30"><i class="fa-solid fa-arrow-down"></i></button>
                            <button @click.stop="showEditModal(item)" class="px-2 ml-2 hover:text-kyoto-dark"><i class="fa-solid fa-pen-to-square"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <button @click="showAddModal = true" class="add-btn-float">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div> <div v-if="currentTab === 'info'" class="space-y-6">
            
            <section class="bg-kyoto-card rounded-xl p-5 shadow-sm">
                <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fa-solid fa-money-bill-transfer mr-3 text-kyoto-green"></i>匯率換算</h2>
                <div class="flex items-center space-x-4">
                    <div class="flex-1">
                        <label class="text-xs text-gray-500 pl-1">日幣 (JPY)</label>
                        <input type="number" v-model="currencyJpy" @input="calculateTwd" class="w-full bg-kyoto-bg rounded-lg p-3 font-bold text-lg focus:outline-none focus:ring-2 focus:ring-kyoto-green">
                    </div>
                    <i class="fa-solid fa-arrow-right-arrow-left text-gray-400 mt-5"></i>
                    <div class="flex-1">
                        <label class="text-xs text-gray-500 pl-1">台幣 (TWD) <span class="text-[10px]">(匯率: {{exchangeRate}})</span></label>
                        <input type="number" v-model="currencyTwd" readonly class="w-full bg-kyoto-bg rounded-lg p-3 font-bold text-lg text-gray-600">
                    </div>
                </div>
            </section>

            <section>
                <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fa-solid fa-plane mr-3 text-kyoto-green"></i>航班資訊</h2>
                
                <div class="bg-[#f8f4ec] rounded-xl overflow-hidden shadow-sm mb-4">
                    <div class="bg-[#4d6a7a] text-white px-4 py-2 text-sm font-medium flex justify-between">
                        <span>去程 TPE 前往 KIX</span>
                        <span>經濟艙</span>
                    </div>
                    <div class="p-5 text-kyoto-dark">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-lg">JX820</span>
                            </div>
                             <div class="text-sm text-gray-500 flex items-center">
                                <i class="fa-regular fa-clock mr-1"></i> 2 小時 30 分鐘
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-center mb-4">
                             <div class="text-left">
                                 <div class="text-sm text-gray-500 mb-1">2025年12月29日</div>
                                 <div class="text-4xl font-bold text-[#8c6239]">07:40</div>
                                 <div class="text-2xl font-bold mt-1">TPE</div>
                                 <div class="text-sm text-gray-500 mt-1">臺北</div>
                                 <div class="text-xs text-gray-400 mt-1">臺灣桃園國際機場<br>1 航廈</div>
                             </div>
                             <div class="flex-1 px-4 flex flex-col items-center">
                                 <div class="w-full h-[2px] bg-[#8c6239] relative flex items-center justify-end">
                                     <i class="fa-solid fa-plane text-[#8c6239] transform rotate-90 absolute -right-1 -top-2 text-lg"></i>
                                 </div>
                             </div>
                             <div class="text-right">
                                 <div class="text-sm text-gray-500 mb-1">2025年12月29日</div>
                                 <div class="text-4xl font-bold text-[#8c6239]">11:10</div>
                                 <div class="text-2xl font-bold mt-1">KIX</div>
                                 <div class="text-sm text-gray-500 mt-1">大阪</div>
                                 <div class="text-xs text-gray-400 mt-1">關西國際機場<br>1 航廈</div>
                             </div>
                        </div>
                         <div class="text-xs text-gray-500 border-t border-gray-200 pt-3">
                            實際營運：STARLUX AIRLINES JX820
                        </div>
                         <div class="mt-4 bg-[#f0eadd] py-2 rounded text-center text-[#8c6239] font-medium flex items-center justify-center">
                            <i class="fa-solid fa-circle-check mr-2"></i> 機位確認
                        </div>
                    </div>
                </div>

                 <div class="bg-[#f8f4ec] rounded-xl overflow-hidden shadow-sm">
                    <div class="bg-[#4d6a7a] text-white px-4 py-2 text-sm font-medium flex justify-between">
                        <span>回程 KIX 前往 TPE</span>
                        <span>經濟艙</span>
                    </div>
                    <div class="p-5 text-kyoto-dark">
                        <div class="flex justify-between items-center mb-6">
                            <div class="flex items-center space-x-2">
                                <span class="font-bold text-lg">JX823</span>
                            </div>
                             <div class="text-sm text-gray-500 flex items-center">
                                <i class="fa-regular fa-clock mr-1"></i> 3 小時 15 分鐘
                            </div>
                        </div>
                        <div class="flex justify-between items-center text-center mb-4">
                             <div class="text-left">
                                 <div class="text-sm text-gray-500 mb-1">2026年1月2日</div>
                                 <div class="text-4xl font-bold text-[#8c6239]">14:00</div>
                                 <div class="text-2xl font-bold mt-1">KIX</div>
                                 <div class="text-sm text-gray-500 mt-1">大阪</div>
                                 <div class="text-xs text-gray-400 mt-1">關西國際機場<br>1 航廈</div>
                             </div>
                              <div class="flex-1 px-4 flex flex-col items-center">
                                 <div class="w-full h-[2px] bg-[#8c6239] relative flex items-center justify-end">
                                     <i class="fa-solid fa-plane text-[#8c6239] transform rotate-90 absolute -right-1 -top-2 text-lg"></i>
                                 </div>
                             </div>
                             <div class="text-right">
                                 <div class="text-sm text-gray-500 mb-1">2026年1月2日</div>
                                 <div class="text-4xl font-bold text-[#8c6239]">16:15</div>
                                 <div class="text-2xl font-bold mt-1">TPE</div>
                                 <div class="text-sm text-gray-500 mt-1">臺北</div>
                                 <div class="text-xs text-gray-400 mt-1">臺灣桃園國際機場<br>1 航廈</div>
                             </div>
                        </div>
                         <div class="text-xs text-gray-500 border-t border-gray-200 pt-3">
                            實際營運：STARLUX AIRLINES JX823
                        </div>
                         <div class="mt-4 bg-[#f0eadd] py-2 rounded text-center text-[#8c6239] font-medium flex items-center justify-center">
                            <i class="fa-solid fa-circle-check mr-2"></i> 機位確認
                        </div>
                    </div>
                </div>
            </section>

            <section class="bg-kyoto-card rounded-xl p-5 shadow-sm">
                 <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fa-solid fa-bed mr-3 text-kyoto-green"></i>住宿資訊</h2>
                 <h3 class="text-lg font-bold text-[#003580] mb-2">Miyako City Kintetsu Kyoto Station</h3>
                 <div class="space-y-3 text-sm">
                     <p><i class="fa-regular fa-calendar mr-2 text-gray-400"></i> 2025年12月29日 - 2026年1月2日 (4晚)</p>
                     <p class="flex items-start">
                         <i class="fa-solid fa-location-dot mr-2 text-gray-400 mt-1"></i>
                         <span>京都府, 京都, Shimogyo-ku Higashishiokoji Kamadonocho 1-9, 日本</span>
                     </p>
                     <p><i class="fa-solid fa-phone mr-2 text-gray-400"></i> +81 75-692-2111</p>
                 </div>
                 <a href="https://www.google.com/maps/search/?api=1&query=Miyako+City+Kintetsu+Kyoto+Station" target="_blank" class="mt-4 w-full py-3 bg-kyoto-green text-white rounded-lg font-medium flex items-center justify-center">
                     <i class="fa-solid fa-diamond-turn-right mr-2"></i> 導航至飯店
                 </a>
            </section>
            
             <section class="bg-kyoto-card rounded-xl p-5 shadow-sm">
                 <h2 class="text-xl font-bold mb-4 flex items-center"><i class="fa-solid fa-triangle-exclamation mr-3 text-kyoto-accent"></i>緊急醫療/聯絡</h2>
                 <div class="grid grid-cols-2 gap-4">
                     <a href="tel:110" class="flex items-center p-3 bg-kyoto-bg rounded-lg">
                         <i class="fa-solid fa-user-shield text-2xl text-kyoto-dark mr-3"></i>
                         <div><div class="font-bold">警察局</div><div class="text-sm text-gray-500">撥打 110</div></div>
                     </a>
                     <a href="tel:119" class="flex items-center p-3 bg-kyoto-bg rounded-lg">
                         <i class="fa-solid fa-truck-medical text-2xl text-kyoto-accent mr-3"></i>
                         <div><div class="font-bold">救護車/火警</div><div class="text-sm text-gray-500">撥打 119</div></div>
                     </a>
                 </div>
            </section>
             <div class="h-10"></div> </div> <div v-if="currentTab === 'shopping'">
            <h2 class="text-2xl font-bold mb-6">購物清單</h2>
            
            <div class="grid grid-cols-2 gap-4">
                <div v-for="(item, index) in shoppingList" :key="index" class="bg-kyoto-card rounded-xl shadow-sm overflow-hidden relative group">
                    <div class="h-32 bg-gray-200 bg-cover bg-center" :style="item.image ? `background-image: url('${item.image}')` : ''">
                        <div v-if="!item.image" class="w-full h-full flex items-center justify-center text-gray-400">
                            <i class="fa-regular fa-image text-3xl"></i>
                        </div>
                    </div>
                    <div class="p-3">
                        <h3 class="font-bold truncate">{{ item.name }}</h3>
                    </div>
                    <button @click="deleteShoppingItem(index)" class="absolute top-2 right-2 w-8 h-8 bg-white rounded-full shadow flex items-center justify-center text-kyoto-accent opacity-0 group-hover:opacity-100 transition-opacity">
                        <i class="fa-solid fa-trash-can"></i>
                    </button>
                </div>
            </div>
            
            <div v-if="shoppingList.length === 0" class="text-center text-gray-400 py-10">
                <i class="fa-solid fa-basket-shopping text-5xl mb-4"></i>
                <p>還沒有想買的東西嗎？<br>點擊右下角新增</p>
            </div>

            <button @click="showShoppingModal = true" class="add-btn-float bg-[#cf5d3e]">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div> <div v-if="currentTab === 'expenses'">
            <div class="bg-kyoto-card rounded-xl p-6 shadow-sm mb-6 text-center">
                <h3 class="text-gray-500 mb-2">旅程總花費 (JPY)</h3>
                <div class="text-4xl font-bold text-kyoto-dark">¥ {{ totalExpenses.toLocaleString() }}</div>
            </div>

            <h2 class="text-xl font-bold mb-4">花費明細</h2>
            <div class="space-y-3">
                <div v-for="(expense, index) in expensesList" :key="index" class="bg-kyoto-card rounded-xl p-4 shadow-sm flex justify-between items-center">
                    <div class="flex items-center overflow-hidden mr-4">
                        <div :class="['w-10 h-10 rounded-full flex items-center justify-center text-white mr-4 flex-shrink-0', getExpenseCategoryColor(expense.category)]">
                            <i :class="getExpenseCategoryIcon(expense.category)"></i>
                        </div>
                        <div class="truncate">
                            <h4 class="font-bold truncate">{{ expense.name }}</h4>
                            <div class="text-xs text-gray-500">
                                {{ expense.date }} · {{ expense.paymentMethod === 'cash' ? '現金' : '信用卡' }}
                                <span v-if="expense.notes" class="ml-1">· {{ expense.notes }}</span>
                            </div>
                        </div>
                    </div>
                    <div class="font-bold text-lg whitespace-nowrap">
                        ¥ {{ expense.amount.toLocaleString() }}
                    </div>
                </div>
            </div>
             <div v-if="expensesList.length === 0" class="text-center text-gray-400 py-10">
                <i class="fa-solid fa-receipt text-5xl mb-4"></i>
                <p>尚未有花費記錄</p>
            </div>

            <button @click="showExpenseModal = true" class="add-btn-float bg-[#eab308]">
                <i class="fa-solid fa-plus"></i>
            </button>
        </div> </main>

    <div v-if="showAddModal || showEditModalState" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">{{ showEditModalState ? '編輯行程' : '新增行程' }}</h3>
            <p class="text-gray-500 mb-4">這裡將放置新增行程的表單 (類別、名稱、時間、備註等)。由於篇幅限制，此處功能暫時省略，僅展示彈窗效果。</p>
            
            <div class="flex justify-end space-x-3 mt-6">
                <button @click="closeModals" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium">取消</button>
                <button v-if="showEditModalState" class="px-4 py-2 rounded-lg bg-red-100 text-red-600 font-medium">刪除</button>
                <button @click="closeModals" class="px-4 py-2 rounded-lg bg-kyoto-green text-white font-medium">確認儲存</button>
            </div>
        </div>
    </div>

    <div v-if="showShoppingModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-md p-6">
            <h3 class="text-xl font-bold mb-4">新增想買的物品</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">商品名稱</label>
                    <input v-model="newShoppingItem.name" type="text" class="w-full p-3 bg-kyoto-bg rounded-lg focus:outline-none focus:ring-2 focus:ring-kyoto-green">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">圖片 (選填)</label>
                    <div class="flex items-center justify-center w-full">
                        <label class="flex flex-col w-full h-32 border-2 border-dashed border-gray-300 rounded-lg cursor-pointer hover:bg-kyoto-bg hover:border-kyoto-green transition-all relative overflow-hidden">
                            <div v-if="!newShoppingItem.image" class="flex flex-col items-center justify-center pt-7">
                                <i class="fa-solid fa-camera text-3xl text-gray-400"></i>
                                <p class="pt-1 text-sm tracking-wider text-gray-400">點擊上傳照片</p>
                            </div>
                             <img v-if="newShoppingItem.image" :src="newShoppingItem.image" class="absolute inset-0 w-full h-full object-cover" />
                            <input type="file" class="opacity-0" accept="image/*" @change="handleImageUpload">
                        </label>
                    </div>
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button @click="closeModals" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium">取消</button>
                <button @click="addShoppingItem" :disabled="!newShoppingItem.name" class="px-4 py-2 rounded-lg bg-kyoto-green text-white font-medium disabled:opacity-50">新增</button>
            </div>
        </div>
    </div>

    <div v-if="showExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end sm:items-center justify-center p-4">
        <div class="bg-white rounded-t-2xl sm:rounded-2xl w-full max-w-md p-6 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">記一筆</h3>
            <div class="space-y-4">
                 <div class="grid grid-cols-3 gap-2">
                     <button v-for="cat in ['food','transport','shopping','ticket','hotel','other']" :key="cat"
                             @click="newExpense.category = cat"
                             :class="['p-2 rounded-lg flex flex-col items-center justify-center text-sm transition-all', 
                                      newExpense.category === cat ? 'bg-kyoto-dark text-white shadow-md' : 'bg-kyoto-bg text-gray-600']">
                         <i :class="[getExpenseCategoryIcon(cat), 'text-xl mb-1']"></i>
                         {{ getExpenseCategoryName(cat) }}
                     </button>
                 </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">名稱/項目</label>
                    <input v-model="newExpense.name" type="text" class="w-full p-3 bg-kyoto-bg rounded-lg focus:outline-none focus:ring-2 focus:ring-kyoto-green">
                </div>
                 <div class="flex space-x-4">
                     <div class="flex-1">
                         <label class="block text-sm font-medium text-gray-700 mb-1">金額 (JPY)</label>
                         <input v-model.number="newExpense.amount" type="number" class="w-full p-3 bg-kyoto-bg rounded-lg focus:outline-none focus:ring-2 focus:ring-kyoto-green font-bold">
                     </div>
                      <div>
                         <label class="block text-sm font-medium text-gray-700 mb-1">日期</label>
                         <input v-model="newExpense.date" type="date" class="p-3 bg-kyoto-bg rounded-lg focus:outline-none focus:ring-2 focus:ring-kyoto-green">
                     </div>
                 </div>
                  <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">付款方式</label>
                     <div class="flex space-x-2">
                        <button @click="newExpense.paymentMethod = 'cash'" :class="['flex-1 p-2 rounded-lg text-sm font-medium transition-all', newExpense.paymentMethod === 'cash' ? 'bg-green-100 text-green-800 border-2 border-green-300' : 'bg-kyoto-bg text-gray-600']"><i class="fa-solid fa-coins mr-1"></i> 現金</button>
                        <button @click="newExpense.paymentMethod = 'card'" :class="['flex-1 p-2 rounded-lg text-sm font-medium transition-all', newExpense.paymentMethod === 'card' ? 'bg-blue-100 text-blue-800 border-2 border-blue-300' : 'bg-kyoto-bg text-gray-600']"><i class="fa-regular fa-credit-card mr-1"></i> 信用卡</button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">備註 (選填)</label>
                    <input v-model="newExpense.notes" type="text" class="w-full p-3 bg-kyoto-bg rounded-lg focus:outline-none focus:ring-2 focus:ring-kyoto-green">
                </div>
            </div>
            <div class="flex justify-end space-x-3 mt-6">
                <button @click="closeModals" class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 font-medium">取消</button>
                <button @click="addExpense" :disabled="!newExpense.name || !newExpense.amount" class="px-4 py-2 rounded-lg bg-[#eab308] text-white font-medium disabled:opacity-50">儲存花費</button>
            </div>
        </div>
    </div>

</div>

<script>
    const { createApp, ref, computed, reactive } = Vue;

    createApp({
        setup() {
            // --- 狀態變數 ---
            const currentTab = ref('itinerary');
            const selectedDayIndex = ref(0);
            const showAddModal = ref(false);
            const showEditModalState = ref(false);
            const showShoppingModal = ref(false);
            const showExpenseModal = ref(false);
            const editingItem = ref(null);

            // 匯率相關
            const exchangeRate = ref(0.22); // 模擬匯率 JPY to TWD
            const currencyJpy = ref(10000);
            const currencyTwd = ref(Math.round(10000 * 0.22));

            // --- 資料模型 (Hardcoded Data) ---
            const itineraryData = reactive([
                {
                    date: '2025-12-29',
                    items: [
                        { id: 1, type: 'flight', name: 'JX820 TPE -> KIX', time: '07:40', travelTimeText: '', notes: '07:40 起飛, 11:10 抵達。落地第一件事：買線香！' },
                        { id: 2, type: 'sightseeing', name: '東寺 (五重塔)', time: '14:30', travelTimeText: '約 1小時 (關西機場至京都)', businessHours: '08:00-17:00', ticketInfo: '￥500', notes: '庭園很大，適合小孩跑跳，大人去買香。' },
                    ]
                },
                {
                    date: '2025-12-30',
                    items: [
                        { id: 3, type: 'sightseeing', name: '京都水族館', time: '10:00', travelTimeText: '約 15分 (公車)', businessHours: '10:00-18:00', ticketInfo: '成人￥2200', notes: '看企鵝、大山椒魚。避開寒風室內行程。' },
                        { id: 4, type: 'shopping', name: '京都 BAL', time: '15:00', travelTimeText: '約 20分 (公車)', businessHours: '11:00-20:00', notes: '逛無印良品、喝咖啡，質感逛街。' },
                        { id: 5, type: 'other', name: '鴨川散步', time: '17:00', travelTimeText: '約 5分 (步行)', notes: '感受京都傍晚氛圍。' },
                    ]
                },
                {
                    date: '2025-12-31',
                    items: [
                        { id: 6, type: 'sightseeing', name: '奈良公園', time: '09:30', travelTimeText: '約 45分 (近鐵)', notes: '鹿很熱情，爸爸要負責拿仙貝保護小孩喔！' },
                        { id: 7, type: 'food', name: '吃釜飯 (志津香)', time: '13:00', travelTimeText: '約 10分 (步行)', notes: '人氣美食，可能需要排隊。' },
                        { id: 8, type: 'hotel', name: '回飯店午睡', time: '15:00', travelTimeText: '約 50分 (近鐵回京都)', notes: '儲備體力晚上跨年。' },
                        { id: 9, type: 'sightseeing', name: '知恩院 / 八坂神社 (跨年)', time: '21:00', travelTimeText: '約 20分 (公車)', notes: '知恩院鐘聲震撼，山門外聽就有氣氛，不用擠進去。' },
                    ]
                },
                {
                    date: '2026-01-01',
                    items: [
                        { id: 10, type: 'sightseeing', name: '平安神宮 (新年參拜)', time: '11:30', travelTimeText: '約 25分 (公車)', notes: '感受日本過年氣氛 (初詣)，超大紅色鳥居。' },
                        { id: 11, type: 'sightseeing', name: '南禪寺 & 藍瓶咖啡', time: '15:00', travelTimeText: '約 15分 (步行)', notes: '悠閒不趕路行程。' },
                    ]
                },
                {
                    date: '2026-01-02',
                    items: [
                        { id: 12, type: 'transport', name: '搭乘 Haruka (Hello Kitty 列車)', time: '09:30', travelTimeText: '約 15分 (至京都站)', notes: '前往機場。' },
                        { id: 13, type: 'other', name: '抵達關西機場 (KIX)', time: '11:00', travelTimeText: '約 80分 (JR Haruka)', notes: '準備掛行李、最後採買。' },
                        { id: 14, type: 'flight', name: 'JX823 KIX -> TPE', time: '14:00', travelTimeText: '', notes: '14:00 起飛, 16:15 抵達。避開過年人潮，優雅回家。' },
                    ]
                }
            ]);

            const shoppingList = reactive([
                // 範例資料
                // { name: '線香 (松榮堂)', image: '...' } 
            ]);

            const expensesList = reactive([
                // 範例資料
                // { category: 'food', name: '午餐拉麵', date: '2025-12-29', amount: 3500, paymentMethod: 'cash', notes: '' }
            ]);

            // 新增項目的暫存物件
            const newShoppingItem = reactive({ name: '', image: null });
            const newExpense = reactive({ 
                category: 'food', 
                name: '', 
                amount: null, 
                date: new Date().toISOString().split('T')[0], // 預設今天
                paymentMethod: 'cash', 
                notes: '' 
            });


            // --- Computed Properties ---
            const currentDayItinerary = computed(() => {
                return itineraryData[selectedDayIndex.value];
            });

            const totalExpenses = computed(() => {
                return expensesList.reduce((sum, item) => sum + item.amount, 0);
            });

            // --- Methods ---

            // 輔助函數：日期顯示
            const getDayName = (dateStr) => {
                const date = new Date(dateStr);
                return date.toLocaleDateString('en-US', { weekday: 'short' });
            };
            const getDayNumber = (dateStr) => {
                const date = new Date(dateStr);
                return date.getDate();
            };

            // 輔助函數：分類名稱與圖示
            const getCategoryName = (type) => {
                const map = { sightseeing: '景點', food: '美食', shopping: '購物', flight: '航班', hotel: '住宿', transport: '交通', other: '其他' };
                return map[type] || '其他';
            };
            const getTransportIcon = (type) => {
                // 這裡先簡單用隨機圖示代替，實際應根據資料欄位判斷
                const icons = ['fa-solid fa-person-walking', 'fa-solid fa-train-subway', 'fa-solid fa-bus'];
                return icons[Math.floor(Math.random() * icons.length)];
            };
            
            // 輔助函數：時間格式化 (移除秒)
            const formatTime = (timeStr) => {
                return timeStr ? timeStr.substring(0, 5) : '';
            };

            // 功能：開啟 Google Maps
            const openGoogleMaps = (destination) => {
                // 使用 encodeURIComponent 處理中文地點
                const query = encodeURIComponent(destination + ', 京都');
                window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
            };

            // 功能：行程排序 (上移/下移)
            const moveItem = (index, direction) => {
                const items = currentDayItinerary.value.items;
                const newIndex = index + direction;
                if (newIndex >= 0 && newIndex < items.length) {
                    // 交換陣列元素
                    [items[index], items[newIndex]] = [items[newIndex], items[index]];
                }
            };

            // 功能：匯率計算
            const calculateTwd = () => {
                currencyTwd.value = Math.round(currencyJpy.value * exchangeRate.value);
            };

            // 功能：處理圖片上傳 (轉 Base64)
            const handleImageUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        newShoppingItem.image = e.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            // 功能：新增購物項目
            const addShoppingItem = () => {
                if (newShoppingItem.name) {
                    shoppingList.push({ ...newShoppingItem });
                    // 重置表單
                    newShoppingItem.name = '';
                    newShoppingItem.image = null;
                    closeModals();
                }
            };
             // 功能：刪除購物項目
            const deleteShoppingItem = (index) => {
                shoppingList.splice(index, 1);
            };

            // 功能：花費分類輔助
            const getExpenseCategoryName = (cat) => ({ food:'飲食',transport:'交通',shopping:'購物',ticket:'門票',hotel:'住宿',other:'其他' }[cat]);
            const getExpenseCategoryIcon = (cat) => ({ food:'fa-utensils',transport:'fa-train',shopping:'fa-bag-shopping',ticket:'fa-ticket',hotel:'fa-bed',other:'fa-circle' }[cat] || 'fa-circle');
            const getExpenseCategoryColor = (cat) => ({ food:'bg-orange-400',transport:'bg-blue-500',shopping:'bg-pink-500',ticket:'bg-purple-500',hotel:'bg-indigo-500',other:'bg-gray-400' }[cat] || 'bg-gray-400');

            // 功能：新增花費
            const addExpense = () => {
                 if (newExpense.name && newExpense.amount) {
                    expensesList.unshift({ ...newExpense }); // 加到最前面
                    // 重置表單 (保留部分設定)
                    newExpense.name = '';
                    newExpense.amount = null;
                    newExpense.notes = '';
                    closeModals();
                }
            };

            // Modal 控制
            const closeModals = () => {
                showAddModal.value = false;
                showEditModalState.value = false;
                showShoppingModal.value = false;
                showExpenseModal.value = false;
                editingItem.value = null;
            };
            const showEditModal = (item) => {
                editingItem.value = item;
                showEditModalState.value = true;
                // 這裡應該要將 item 資料填入編輯表單
                alert("編輯功能提示：實際應用時，這裡會彈出帶有資料的表單供修改。");
                closeModals(); // 暫時關閉
            };


            return {
                currentTab,
                selectedDayIndex,
                itineraryData,
                shoppingList,
                expensesList,
                currentDayItinerary,
                totalExpenses,
                // Modals State
                showAddModal, showEditModalState, showShoppingModal, showExpenseModal,
                // Forms Data
                newShoppingItem, newExpense,
                // Currency
                currencyJpy, currencyTwd, exchangeRate,
                // Methods
                getDayName, getDayNumber, getCategoryName, getTransportIcon, formatTime,
                openGoogleMaps, moveItem, calculateTwd,
                handleImageUpload, addShoppingItem, deleteShoppingItem,
                getExpenseCategoryName, getExpenseCategoryIcon, getExpenseCategoryColor, addExpense,
                closeModals, showEditModal
            };
        }
    }).mount('#app');
</script>
</body>
</html>
